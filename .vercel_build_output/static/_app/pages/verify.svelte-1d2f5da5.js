import{S as d,i as u,s as f,j as p,m as g,o as h,H as _,x as $,u as w,v as k,A as I,X as S,af as b,at as j,au as x,av as L,aw as r,ax as y,ay as E,az as v}from"../chunks/vendor-c53e2aa3.js";import{u as i}from"../chunks/stores-31a253bf.js";import{g as c}from"../chunks/firebase-3e4355ad.js";import{L as A,g as l}from"../chunks/loader-ef6a9610.js";import"../chunks/singletons-12a22614.js";function U(n){let e,t;return e=new A({props:{text:"Logging you in!"}}),{c(){p(e.$$.fragment)},l(a){g(e.$$.fragment,a)},m(a,o){h(e,a,o),t=!0},p:_,i(a){t||($(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){k(e,a)}}}function D(n){return I(()=>{const e=S(c()),t=b(c());if(j(e,location.href)){let a=localStorage.getItem("loginEmail");a||(a=prompt("Please provide your email for confirmation")),x(e,a,location.href).then(o=>{localStorage.removeItem("loginEmail"),o._tokenResponse.isNewUser?(console.log("isNew"),L(r(t,"Users"),{email:a,passwords:[]}).then(s=>{localStorage.setItem("userID",s.id),i.update(m=>({id:s.id,email:a,passwords:[]})),l("/dashboard")}).catch(s=>alert(s))):y(E(r(t,"Users"),v("email","==",a))).then(s=>{localStorage.setItem("userID",s.docs[0].id),i.update(m=>({id:s.docs[0].id,email:a,passwords:s.docs[0].data().passwords})),l("/dashboard")}).catch(s=>alert(s))}).catch(o=>alert(`siwel-${o}`))}}),[]}class z extends d{constructor(e){super();u(this,e,D,U,f,{})}}export{z as default};
